# Tock系统架构

Tock是业内首个采用非C/C++编程语言开发的嵌入式操作系统。这一特性使其在操作系统架构与嵌入式安全领域都具有独特价值。本章将深入剖析Tock的构建机制，并阐述其作为安全嵌入式应用开发平台的核心优势。

## 为什么是Tock？

Tock是一款源自学术研究项目的嵌入式操作系统。尽管它可能尚未达到生产就绪状态，但具备一项显著优势：这是首个采用C语言以外的编程语言开发的完整嵌入式操作系统。更值得关注的是，业界也对其应用表现出浓厚兴趣（搜索OpenSK和OpenTitan项目）。它或许不会成为未来广泛使用的操作系统。但毋庸置疑，它必将为其他现代语言编写的操作系统开辟道路。

本书作者坚信，对嵌入式操作系统进行全新视角的审视至关重要。当前所有商用操作系统均基于五十年前确立的相同原理构建。这些系统虽稳健可靠，却难以适应下一代设备的需求。

通过本书，我们试图为读者提供全新的视角。

## 一些有关操作系统的词语

在深入探讨Tock的设计之前，我们必须先了解操作系统的构建方式。为此，下一节将重点阐述内核、驱动程序和应用程序的含义。

### 内核

操作系统本身被称为内核。这是与应用程序共同运行的软件，并负责管理系统所有硬件和软件资源。内核负责决定哪些程序必须运行、哪些程序需要等待、哪些程序被允许访问文件或网络连接等资源。系统中绝大多数任务都由内核执行，例如从文件读取和向文件写入数据、与网络发送和接收数据、读取键盘输入等。

从开发者的角度来看，内核负责与硬件交互，并为在其上运行的程序提供两个标准接口：应用二进制接口（ABI）和应用程序接口（API）。这极大简化了开发者的工作。若没有内核，开发者就必须编写大量代码才能与硬件交互。每种硬件都各不相同，需要采用不同的接口方式。

| 注意 | ABI代表进程向内核发送请求（系统调用）并接收内核返回值所采用的标准。另一方面，API代表进程可向内核发送的请求集合。|
| ---- | ----- |

举个例子，想想声卡。根据制造商的不同，每块声卡暴露的接口不一，这意味着需要使用不同的函数来控制它。当使用内核时，内核会识别声卡类型并知道如何与之交互 —— 换言之，知道调用哪些函数。随后它将声卡API导出给开发者。只要是声卡，开发者就能使用相同的内核API，无需关注具体硬件。只要系统运行的内核导出了相同的声音ABI，同一程序就能在任何系统上运行。

只要系统正常工作，内核对开发者和用户而言完全不可见。用户仅在系统彻底崩溃时才会注意到内核，例如Windows的蓝屏死机或Linux/macOS的系统崩溃（Panic）。

